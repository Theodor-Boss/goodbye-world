<!DOCTYPE html>
<html>
<head lang="da-DK">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="icon" href="../img/andersand.webp">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="css/main.css">

    <!-- LaTeX -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Prism.js CSS for the theme -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <!-- Prism.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q6G8BFEWN6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Q6G8BFEWN6');
    </script>
</head>
<body>
    <header class="header-main">
        <div class="site-title">theodormyhre.dk</div>
        <nav></nav>
        <div></div>
    </header>

    <h1>Projekt 2: 3D-Vektorfelt for hormonbalancen</h1>

    <div class="gif">
        <img id="vektorfelt1" src="img/vektorfelt1.gif" alt="">
    </div>

    <p>
        Dette projekt lavede jeg da jeg gik i gymnasiet.
        Projektet er kraftigt inspireret af en 
        øveeksamensopgave vi lavede på Biologi A om 
        hormoner. 
        <br>
        Opgaven handlede om de tre hormoner LH, FSH og 
        TSH, som der er en interessant sammenhæng mellem
        og som dette projekt handler om.
        <br>
        Af hensyn til den nysgerrige læsser vedhæfter
        jeg hele opgaven herunder. Det er dog kun 
        spørgsmål 4 der er interessant i denne 
        kontekst. Det har jeg sat en 
        <span class="red-text">rød</span> ring om, så
        resten er strengt taget ikke nødvendigt at læse
        for at forstå mit projekt, men kan gøre det 
        lettere at følge med:
    </p>
        
    <div class="assignment">
        <br>
        <img src="img/Billede1.png" alt="">
        <br>
        <img src="img/Billede2.png" alt="">
        <br>
        <img src="img/Billede3.png" alt="">
        <br>
        <img id="important-image" src="img/Billede4.png" alt="">
        <br>
        <img src="img/Billede5.png" alt="">
        <br>
    </div>

    <h2>Så hvad går opgaven ud på og hvorfor er den interessant?</h2>

    <p>
        Opgaven går ud på at forklare resultaterne af et eksperiment. I eksperimentet indsprøjtes 100 mikrogram af et hormon (LH-releasing-hormon), hvorefter koncentrationen af et andet hormon (LH) måles løbende. Målingerne er plottet i et koordinatsystem vist i Figur 3.
        <br>
        Opgaven er interessant af flere årsager. Det er selvfølgelig spændende hvordan kroppen fungerer, men det der fascinerer mig er muligheden for at løse opgaven med matematik og programmering. For at se, hvorfor det er smart og interessant at bruge matematik til opgaven, vil jeg forsøge at løse opgaven uden brug af matematik.
    </p>
    <p>
        Der er flere måder at forklare resultaterne af eksperimentet på, men det der sker er grundlæggende et eksempel på <span class="kursiv">negativ feedback</span>.
    </p>

    <div id="negativ-feedback">
        <img src="img/negativ-feedback.png" alt="">
    </div>
    <h3>Credit: <a target="_blank" href="https://www.detergodtatvide.dk/konshormoner/">detergodtatvide.dk/kønshormoner</a></h3>

    <p>
        Det der skal forklares er, hvorfor LH-koncentrationen ændrer sig. Der ses en kraftig stigning i koncentrationen af LH kort efter indsprøjtningen af det andet hormon (LH-releasing-hormon), og senere ses et fald i koncentationen af LH. 
        <span class="brlarge"></span>
        Forklaringen på stigningen i starten er, at det indsprøjtede hormon (LH-releasing-hormon) har en stimulerende effekt på dannelsen af LH, se opgavens Figur 2.
        <span class="brsmall"></span>
        LH-koncentrationen går ned igen efter lidt tid. Det skyldes udskillelsen af hormonet fra blodet, som bl.a. foregår i nyrerne. Udskillelsen finder faktisk sted under hele forløbet 
        (mere om det senere), 
        men grunden til at LH-koncentrationen først begynder at falde efter noget tid, er at <span class="kursiv">produktionen</span> af hormonet bliver mindre og mindre med tiden. 
        <span class="brlarge"></span>
        Nu opstår dog spørgsmålet, hvorfor produktionen af hormonet bliver mindre og mindre med tiden. Det er lidt sværeste at forklare. Det skyldes nemlig to ting:
    </p>

    <ul>
        <li>
            Den ene grund til at produktionen af LH falder er, at LH går ud i blodet og stimulerer målcellerne til at dannes deres hormon (målcelle-hormon). Dette hormon kommer også ud i blodet og rammer hypofysen, og får den til at mindske produktionen af LH. Dette er et eksempel på simpel, negativ feedback, se Figur 2.
        </li>
        <li>
            Den anden grund til at produktionen af LH falder er, at LH stimuleres positivt af LH-releasing-hormonet (se Figur 2), som jo indspøjtes i starten. LH-releasing-hormon-koncentrationen bliver dog mindre over tid, og derfor stimuleres produktionen af LH ikke nær så meget efter lidt tid.
        </li>
    </ul>

    <span class="brlarge"></span>
    <p>
        Jeg er dog ikke helt færdig, for hvad er mon grunden til, at LH-releasing-hormon-koncentrationen bliver mindre med tiden?
        <br>
        Forklaringen er, at det udskilles fra blodet gennem nyrerne hurtigere end det kan dannes.
        <br>
        LH-releasing-hormon dannes naturligt i Hypotalamus i hjernen, men det viser sig, at målcelle-hormonet påvirker hypotalamus til at mindske den naturlige produktion af LH-releasing-hormon (se Figur 2).
        <span class="brlarge"></span>
        Så LH stiger, hvilket medfører mere målcelle-hormon, hvilket medfører mindre LH-releasing-hormon, hvilket medfører mindre LH osv. osv.
    </p>
    <h2>Hvor matematikken og programmeringen kommer ind i billedet</h2>
    <p>
        Det kan altså godt lade sig gøre at forstå dette system på et vist niveau uden at inddrage røre matematik. Jeg ser dog mindst tre grunde til at det alligevel er oplagt at anvende matematik på det:
    </p>
    <ol type="1">
        <li>
            For det første er det ikke alle spørgsmål der kan besvares alene ud fra intuition. Det er nemlig svært at svare på kvantitative spørgsmål, fx "Hvis en stabil tilstand findes, hvad er da hormon-koncentrationerne i denne tilstand?"
        </li>
        <li>
            For det andet kommer intuitionen til kort, når kompleksiteten øges, fx hvis det viser sig, at der er flere hormoner i spil.
        </li>
        <li>
            For det trejde er det noget pænt interessant matematik, hvor der er rig mulighed for at udfolde sin kreativitet og anvende det meget generelt.
        </li>
    </ol>
    <h2>Faserum</h2>
    <p>  
        Den relevante matematik er 
        <a target="_blank" href="https://en.wikipedia.org/wiki/Phase_space">faserum</a>, 
        <a target="_blank" href="https://en.wikipedia.org/wiki/Vector_field">vektorfelter</a>, og
        <a target="_blank" href="https://en.wikipedia.org/wiki/System_of_differential_equations">systemer af ordinære førsteordens differentialligninger</a>.
        Hvis dette er ukendt for læseren, kan jeg henvise til 3b1b's fremragende video om stoffet:
        <span class="brlarge"></span>
        <a target="_blank" href="https://www.3blue1brown.com/lessons/differential-equations">3b1b: Differential equations, studying the unsolvable</a>
        <span class="brlarge"></span>
    </p>
    <p>
        Mit primære fokus i dette projekt var at opstille en matematisk model for systemet og bruge numeriske metoder til at anvende og studere modellen.
        <span class="brsmall"></span>
        Kernen i opgaven er det her faserum, som består af alle mulige tilstande af systemet. Der er tre variable, nemlig koncentrationen af hhv. LH-releasing-hormon, LH og målcellehormon, så faserummet er i 3D:
    </p>
    \[
    \Large \vec{s} = \begin{pmatrix} [LHreleasinghormon] \\ [LH] \\ [målcellehormon] \end{pmatrix}
    \]
    <p>
        Her har jeg valgt \(s\) for "state".
        <span class="brmedium"></span>
        Der ønskes en model af, hvordan en given tilstand ændrer sig over tid for et givent system. Mere præcist ønsker vi at beskrive den <span class="kursiv">hastighed </span> - altså en 3D-vektor - en given tilstand bevæger sig med i det abstrakte faserum (3b1b forklarer rigtig godt. Se hans video!). For klarhedens skyld har jeg animeret, hvordan det evt. kunne se ud, når systemet udvikler sig og 3D-punktet - der repræsenterer systemets tilstand - flytter sig:
    </p>
    <div class="gif">
        <img src="img/faserum2.gif" alt="" style="width: 600px;">
    </div>
    <p>
        <span class="red-text">Den røde vektor</span> angiver hastigheden af punktet.
    </p>
    <p>
        Matematisk set fås denne vektor ved at differentiere tilstanden \(\vec{s}\) med hensyn til tiden:
    </p>
    \[
    \Large \frac{d\vec{s}}{dt} = \frac{d}{dt} \begin{pmatrix} [LHreleasinghormon] \\ [LH] \\ [målcellehormon] \end{pmatrix} = \begin{pmatrix} \frac{d}{dt} [LHreleasinghormon] \\ \frac{d}{dt} [LH] \\ \frac{d}{dt} [målcellehormon] \end{pmatrix}
    \]

    <p></p>
    
    <p>
        Dette er et system af differentialligninger, men det er faktisk også et vektorfelt, for \(\large \frac{d\vec{s}}{dt}\) afhænger nemlig af \(\vec{s}\) snarere end \(t\) (Systemet har ingen hukommelse).
        <br>
        Grunden til at vi er så interesserede i dette vektorfelt er at det giver os mulighed for at simulere systemets udvikling over tid. Alternativt kunne man også prøve at løse differentialligningssystemet analytisk, men det er som regel umuligt.
    </p>

    <h2>Opstilning af differentialligninger</h2>

    <p>
        Vi skal altså have opstillet tre differentialligniner - én pr. hormon, dvs. vi skal have fundet på nogle fornuftige modeller for, hvordan hormon-koncentrationen ændrer sig pr. tidsenhed som funktion af tilstanden \(\vec{s}\). Vi tager dem én af gangen:
    </p>
    <p>
        \(
        \large \frac{d}{dt} [LHreleasinghormon]
        \)
    </p>
    <p>
        Ændringen i koncentrationen af LH-releasing-hormonet (hypothalamus-hormonet) - afhænger af hvor hurtigt hypothalamus arbejder fratrukket hvor hurtigt kroppen udskiller hormonet fra blodet (det sker vist i nyrerne). Hvor hurtigt hypothalamus arbejder er betinget af koncentrationen af hormonet dannet i målcellerne. Jo højere koncentration, jo mindre aktiv er hypothalamus. Jeg søger derfor en funktion, som er størst, når koncentrationen af målcelle-hormonet er lav og nærmer sig 0, når koncentrationen af målcelle-hormonet er høj. Eksponentialfunktionen virker som et oplagt valg:
    </p>
    <div class="gif">
        <img src="img/LH-releasing-hormon-produktion.png" alt="" style="width: 800px;">
    </div>
    <p>
        Jeg antager desuden, at hvor hurtigt de tre hormoner udskilles fra blodet er ligefrem proportionalt med koncentrationen (Fra matematikken ved vi, at det giver en eksponentiel (negativ) vækst).
        <span class="brmedium"></span>
        En fin model for ændringen i koncentrationen af LH-releasing-hormonet (pr. tidsenhed) er altså:
    </p>
    \[
    \boxed{
    \huge \frac{d}{dt} [LHreleasinghormon] = c_1 \cdot e^{-c_2 \cdot[målcellehormon]} - c_3 \cdot [LHreleasinghormon]
    }
    \]
    <p>
        Her er \(c_1\), \(c_2\) og \(c_3\) konstanter, hvor \(c_1\) kan tænkes som den maksimale produktionshastighed af LH-releasing-hormonet. \(c_2\) fortæller noget om, hvor hurtigt produktionen af LH-releasing-hormonet mindskes, når [målcellehormonet] øges. \(c_3\) bestemmer, hvor hurtigt LH-releasing-hormonet fjernes fra blodet.
    </p>
    <span class="brlarge"></span>
    <p>
        \(
        \large \frac{d}{dt} [LH]
        \)
    </p>
    <p>
        For LH-hormonet søger vi en differentialligning, som beskriver det forhold, at hypofysen reagerer med positiv feedback på LH-releasing-hormonet, og negativ feedback på målcelle-hormonet, dvs. en funktion af to variable. Det kunne fx være denne funktion:
    </p>
    <div class="gif">
        <img src="img/LH-positiv-og-negativ-feedback.png" alt="" style="width: 800px;">
    </div>
    <p>
        Det ses, at produktionen af LH er lav når [målcelle-hormon] er høj. Den maksimale produktionshastighed sker når [LH-releasing-hormon] er høj, og [målcelle-hormon] er fraværende.
        <br>
        Funktionen er fremkommet ud fra følgende ræsonnement:
        <br>
        Antag først at målcelle-hormonet ikke er til stede ved hypofysen. Da er produktionen af LH alene en funktion af LH-releasing-hormonet. Det virker oplagt, at produktionen af LH er 0, når [LH-releasing-hormon] er 0. Produktionen stiger, når [LH-releasing-hormon] vokser, men den kan selvfølgelig kun vokse til et vist punkt (Der er grænser for, hvor hurtigt en kirtel kan arbejde). Jeg vil forvente en funktion, der vokser langsommere og langsommere og til sidst flader ud, og til det formål vil jeg anvende, hvad jeg vil kalde "faldskærmsfunktionen" (da man kan udlede, at det faktisk er denne v(t)-funktion der gør sig gældende ved et frit fald med luftmodstand. Det antages at luftmodstanden er kvadratisk proportional med farten). Den ser sådan her ud:
    </p>
    \[
    \Large f(x)=\frac{e^x-1}{e^x+1}=\frac{1}{1+e^{-x}}-\frac{1}{1+e^x}
    \]    
    <p>
        Omskrivningen viser, at det er en sum af to logistiske funktioner. Grafen for \(f\) er vist her:
    </p>
    <div class="gif">
        <img src="img/LH-positiv-feedback.png" alt="" style="width: 800px;">
    </div>
    <p>
        Så nu har vi en model for produktionshastigheden af LH, når målcellehormonet ikke er til stede. Men hvad hvis det <span class="kursiv">er</span> til stede?
        <span class="brmedium"></span>
        Jeg fik den idé at knytte et tal mellem 0 og 1 til hver koncentation af målcellehormonet og gange det med \(f\). Det sikrer at grafens facon bevares for en fastholdt værdi af [målcellehormon].
        Tallet der ganges på \(f\) skal være 1, når [målcellehormon] er 0 og nærme sig 0, når [målcellehormon] øges. Eksponentialfunktionen virker altså igen omlagt. Det giver os et rimeligt bud på modellen:
    </p>
    \[
    \boxed{
    \huge \frac{d}{dt} [LH] = c_4 \cdot \frac{e^{c_5 \cdot [LHreleasinghormon]}-1}{e^{c_5 \cdot [LHreleasinghormon]}+1} \cdot e^{- c_6 \cdot [målcellehormon]} - c_7 \cdot [LH]
    }
    \]

    <p>
        Det er egentlig sjovt, at LH-producenten har denne noget sofistikerede funktion indbygget i sig! Måske det skal være mit næste projekt at undersøge, hvordan det virker.
    </p>
    <span class="brmedium"></span>
    <p>
        Her er \(c_4\) en konstant der kan fortolkes som den maksimale produktionshastighed af LH. 
        <br>
        \(c_5\) er et tal der bestemmer hvor kraftigt LH-releasing-hormonet virker på hypofysens produktion af LH, dvs. hvor meget af stoffet der skal til for at opnå fx 50% af maksimumkapaciteten.
        <br>
        \(c_6\) bestemmer hvor kraftigt målcellehormonet virker på at dæmpe hypofysens produktion af LH.
        <br>
        Jeg har ligesom før fratrukket leddet \(c_7 \cdot [LH]\) for at tage højde for det, der fjernes af nyrerne.
    </p>
    <span class="brlarge"></span>
    <p>
        \(
        \large \frac{d}{dt} [målcellehormon]
        \)
        <span class="brmedium"></span>
        Den sidste differentialligning skal beskrive ændringen i koncentrationen af målcellehormonet pr. tidsenhed. Målcellerne reagerer på LH med positiv feedback. Jeg benytter igen "faldskærmsfunktionen" (\(f\)). Modellen bliver dermed:
    </p>
    \[
    \boxed{
    \Huge \frac{d}{dt} [målcellehormon] = c_8 \cdot \frac{e^{c_9 \cdot [LH]}-1}{e^{c_9 \cdot [LH]}+1}-c_{10} \cdot [målcellehormon]
    }
    \]
    <p>
        Vi har hermed opstillet vektorfeltet:
    </p>

    \[
    \boxed{

        
    }
    \]

    <br>

    \[
    \frac{d}{dt} [LH]
    \]

    \[
    \frac{d}{dt} [målcellehormon]
    \]

    <p>

    </p>


    <p>
    Lad os kigge på, hvordan det kan implementeres i Python:
    </p>

    <div class="python-code">
        <pre><code class="language-python">
            """
            Funktionen returnerer en fremtidig tilstand for systemet
            ved at opdatere systemets tilstand små skridt ad gangen 
            til det ønskede tidspunkt er nået.
            """
            def state_in_far_future(self, intitial_state, total_time, time_step):
                current_state = intitial_state
                for time in np.arange(0, total_time, time_step):
                    current_state = self.upcoming_state(current_state, time_step)
                return current_state
        </code></pre>
    </div>
    <p>
        <span class="kursiv">Udsnit af kode. Hele koden viser nedenfor.</span>
        <span class="brsmall"></span>
    </p>
    <h2>Matematikken bag</h2>
    <p>
        Dette er ekstremt brugbart i mange sammenhænge. Det der kan være udfordrende ved at bruge metoden er, at man har brug for en matematisk beskrivelse af, hvordan tilstanden skal opdateres mellem hvert tidskridt. Med andre ord har man brug for faserummets første afledede, dvs:
    </p>
    \[
    \Large \frac{d\vec{s}}{dt}
    \]

    \[
    \vec{s} = \begin{pmatrix} [LHreleasinghormon] \\ [LH] \\ [Målcellehormon] \end{pmatrix}
    \]


    <div class="python-code">
        <pre><code class="language-python">
            import numpy as np


            class State:
                def __init__(self, lhreleasinghormon, lh, maalcellehormon):
                    self.lhreleasinghormon = lhreleasinghormon
                    self.lh = lh
                    self.maalcellehormon = maalcellehormon


            class System:
                def __init__(self, c1, c2, c3, c4, c5, c6, c7, c8, c9):
                    self.c1 = c1
                    self.c2 = c2
                    self.c3 = c3
                    self.c4 = c4
                    self.c5 = c5
                    self.c6 = c6
                    self.c7 = c7
                    self.c8 = c8
                    self.c9 = c9

                def faldskaerm(self, x):
                    if x > 100:
                        return 1
                    elif x < -100:
                        return -1
                    else:
                        return (np.exp(x) - 1) / (np.exp(x) + 1)

                def derivative(self, lhreleasinghormon, lh, maalcellehormon):
                    lhreleasinghormon_dot = self.c1 * np.exp(- self.c2 * maalcellehormon) - self.c3 * lhreleasinghormon
                    lh_dot = self.c4 * self.faldskaerm(self.c5 * lhreleasinghormon) * np.exp(-maalcellehormon) - self.c6 * lh
                    maalcellehormon_dot = self.c7 * self.faldskaerm(self.c8 * lh) - self.c9 * maalcellehormon
                    return lhreleasinghormon_dot, lh_dot, maalcellehormon_dot

                def upcoming_state(self, state, time_step):
                    lhreleasinghormon_dot, lh_dot, maalcellehormon_dot = self.derivative(
                        state.lhreleasinghormon,
                        state.lh,
                        state.maalcellehormon
                    )
                    new_lhreleasinghormon = state.lhreleasinghormon + lhreleasinghormon_dot * time_step
                    new_lh = state.lh + lh_dot * time_step
                    new_maalcellehormon = state.maalcellehormon + maalcellehormon_dot * time_step
                    return State(new_lhreleasinghormon, new_lh, new_maalcellehormon)

                def state_in_far_future(self, intitial_state, total_time, time_step):
                    current_state = intitial_state
                    for time in np.arange(0, total_time, time_step):
                        current_state = self.upcoming_state(current_state, time_step)
                    return current_state
        </code></pre>
    </div>

    <p>Here is an inline formula: \( E = mc^2 \).</p>
    <p>Here is a displayed formula:</p>
    \[
    \int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
    \]


    <br>
    <br>
    <br>


    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>




</body>
</html>